#import libraries
import pandas as pd

#config
configfile: 'config/config.yaml'

#rules
include: 'rules/common.smk'
include: 'rules/wtdbg2.smk'
include: 'rules/canu.smk'

#load table
df=(pd.read_table(config['samples'], dtype={'sample': str, 'path': str})
	.set_index('sample', drop=False)
	.sort_index()
)

#run

rule all:
    input:
        expand('results/{sample}/common/mosdepth/{platform}.mosdepth.global.dist.txt',sample=df['sample'].tolist(),platform=['ont', 'illumina']),
        expand('results/{sample}/common/alfred/ont.qc.tsv.gz',sample=df['sample'].tolist()),
        expand('results/{sample}/assembly/wtdbg2/assembly.srp.fa', sample=df['sample'].tolist()),
        expand('results/{sample}/assembly/canu/assembly.contigs.fasta', sample=df['sample'].tolist())


rule qc:
    input:
        expand('results/{sample}/common/mosdepth/{platform}.mosdepth.global.dist.txt',sample=df['sample'].tolist(),platform=['ont', 'illumina']),
        expand('results/{sample}/common/alfred/ont.qc.tsv.gz',sample=df['sample'].tolist())

rule wtdbg2:
    input:
        expand('results/{sample}/assembly/wtdbg2/assembly.srp.fa', sample=df['sample'].tolist())

rule canu:
    input:
        expand('results/{sample}/assembly/canu/assembly.contigs.fasta', sample=df['sample'].tolist())